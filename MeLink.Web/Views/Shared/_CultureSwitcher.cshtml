@using Microsoft.AspNetCore.Builder
@using Microsoft.AspNetCore.Localization
@using Microsoft.Extensions.Options
@using System.Globalization

@inject IOptions<RequestLocalizationOptions> LocOptions

@{
    var requestCulture = Context.Features.Get<IRequestCultureFeature>();
    var currentCultureName = requestCulture.RequestCulture.UICulture.Name;
    var cultureItems = LocOptions.Value.SupportedUICultures
        .Select(c => new SelectListItem { Value = c.Name, Text = c.NativeName })
        .ToList();
}

<div class="relative" x-data="{ open: false }">
    <button @@click="open = !open" class="flex items-center justify-center w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
        <span class="text-lg font-semibold">@currentCultureName.Substring(0, 2).ToUpper()</span>
    </button>

    <div x-show="open"
         @@click.away="open = false"
         class="absolute right-0 mt-2 w-40 bg-white rounded-md shadow-lg z-50"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0 transform scale-95"
         x-transition:enter-end="opacity-100 transform scale-100"
         x-transition:leave="transition ease-in duration-75"
         x-transition:leave-start="opacity-100 transform scale-100"
         x-transition:leave-end="opacity-0 transform scale-95">
        <div class="py-1">
            @foreach (var item in cultureItems)
            {
                <form id="culture-switcher-@item.Value" asp-controller="Culture" asp-action="SetCulture" method="post" role="form" class="w-full">
                    <input type="hidden" name="culture" value="@item.Value" />
                    <input type="hidden" name="returnUrl" value="@Context.Request.Path@Context.Request.QueryString" />
                    <button type="submit" class="text-left w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center">
                        <span class="mr-2">@item.Text</span>
                        @if (item.Value == currentCultureName)
                        {
                            <svg class="w-4 h-4 text-green-500 ml-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                        }
                    </button>
                </form>
            }
        </div>
    </div>
</div>

<!-- Alpine.js for dropdown functionality -->
<script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>